<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sneaker Store API Example</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
        }
        .section h2 {
            color: #555;
            margin-top: 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .loading {
            color: #007bff;
            font-style: italic;
        }
        .error {
            color: #dc3545;
            background: #f8d7da;
            border-color: #f5c6cb;
        }
        .success {
            color: #155724;
            background: #d4edda;
            border-color: #c3e6cb;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõçÔ∏è Sneaker Store API Demo</h1>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats" id="stats">
            <div class="stat-card">
                <div class="stat-number" id="users-count">-</div>
                <div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="products-count">-</div>
                <div class="stat-label">–¢–æ–≤–∞—Ä—ã</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="carts-count">-</div>
                <div class="stat-label">–ö–æ—Ä–∑–∏–Ω—ã</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="wishlists-count">-</div>
                <div class="stat-label">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div>
            </div>
        </div>

        <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
        <div class="section">
            <h2>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
            <button onclick="loadUsers()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
            <button onclick="getUserById(1)">–ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è #1</button>
            <button onclick="searchUsers('john')">–ü–æ–∏—Å–∫ "john"</button>
            <div class="result" id="users-result"></div>
        </div>

        <!-- –¢–æ–≤–∞—Ä—ã -->
        <div class="section">
            <h2>üëü –¢–æ–≤–∞—Ä—ã</h2>
            <button onclick="loadProducts()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã</button>
            <button onclick="getProductById(1)">–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä #1</button>
            <button onclick="searchProducts('jordan')">–ü–æ–∏—Å–∫ "jordan"</button>
            <button onclick="getProductsByBrand('Nike')">–¢–æ–≤–∞—Ä—ã Nike</button>
            <button onclick="getProductsByCategory('Basketball')">–ë–∞—Å–∫–µ—Ç–±–æ–ª—å–Ω—ã–µ</button>
            <button onclick="getProductsByPrice(100, 200)">–¶–µ–Ω–∞ 100-200$</button>
            <div class="result" id="products-result"></div>
        </div>

        <!-- –ö–æ—Ä–∑–∏–Ω—ã -->
        <div class="section">
            <h2>üõí –ö–æ—Ä–∑–∏–Ω—ã</h2>
            <button onclick="loadCarts()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—ã</button>
            <button onclick="getCartByUserId(1)">–ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è #1</button>
            <button onclick="addToCart(1, 1, 1, '9', 'Black/White')">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
            <div class="result" id="carts-result"></div>
        </div>

        <!-- –ò–∑–±—Ä–∞–Ω–Ω–æ–µ -->
        <div class="section">
            <h2>‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h2>
            <button onclick="loadWishlists()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
            <button onclick="getWishlistByUserId(1)">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è #1</button>
            <button onclick="addToWishlist(1, 5, '9', 'Black/White')">–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
            <div class="result" id="wishlists-result"></div>
        </div>

        <!-- –¢–µ—Å—Ç API -->
        <div class="section">
            <h2>üß™ –¢–µ—Å—Ç API</h2>
            <button onclick="testApiConnection()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ</button>
            <button onclick="runAllTests()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</button>
            <div class="result" id="test-result"></div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º API –∏ –ø—Ä–µ–ª–æ–∞–¥–µ—Ä -->
    <script src="scripts/api.js"></script>
    <script src="scripts/preloader.js"></script>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        let apiClient;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', async function() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–ª–æ–∞–¥–µ—Ä
            await preloader.start();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º API
            apiClient = new SneakerStoreAPI.ApiClient();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            await loadStats();
            
            console.log('API Demo –∑–∞–≥—Ä—É–∂–µ–Ω!');
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function loadStats() {
            try {
                const [users, products, carts, wishlists] = await Promise.all([
                    apiClient.get('/users'),
                    apiClient.get('/products'),
                    apiClient.get('/carts'),
                    apiClient.get('/wishlists')
                ]);

                document.getElementById('users-count').textContent = users.data?.length || 0;
                document.getElementById('products-count').textContent = products.data?.length || 0;
                document.getElementById('carts-count').textContent = carts.data?.length || 0;
                document.getElementById('wishlists-count').textContent = wishlists.data?.length || 0;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
        async function loadUsers() {
            showLoading('users-result');
            try {
                const response = await apiClient.get('/users');
                showResult('users-result', response);
            } catch (error) {
                showError('users-result', error);
            }
        }

        async function getUserById(id) {
            showLoading('users-result');
            try {
                const response = await apiClient.get(`/users/${id}`);
                showResult('users-result', response);
            } catch (error) {
                showError('users-result', error);
            }
        }

        async function searchUsers(query) {
            showLoading('users-result');
            try {
                const response = await apiClient.get('/users', { q: query });
                showResult('users-result', response);
            } catch (error) {
                showError('users-result', error);
            }
        }

        // –¢–æ–≤–∞—Ä—ã
        async function loadProducts() {
            showLoading('products-result');
            try {
                const response = await apiClient.get('/products');
                showResult('products-result', response);
            } catch (error) {
                showError('products-result', error);
            }
        }

        async function getProductById(id) {
            showLoading('products-result');
            try {
                const response = await apiClient.get(`/products/${id}`);
                showResult('products-result', response);
            } catch (error) {
                showError('products-result', error);
            }
        }

        async function searchProducts(query) {
            showLoading('products-result');
            try {
                const response = await apiClient.get('/products', { q: query });
                showResult('products-result', response);
            } catch (error) {
                showError('products-result', error);
            }
        }

        async function getProductsByBrand(brand) {
            showLoading('products-result');
            try {
                const response = await apiClient.get('/products', { brand });
                showResult('products-result', response);
            } catch (error) {
                showError('products-result', error);
            }
        }

        async function getProductsByCategory(category) {
            showLoading('products-result');
            try {
                const response = await apiClient.get('/products', { category });
                showResult('products-result', response);
            } catch (error) {
                showError('products-result', error);
            }
        }

        async function getProductsByPrice(min, max) {
            showLoading('products-result');
            try {
                const response = await apiClient.get('/products', { 
                    price_gte: min, 
                    price_lte: max 
                });
                showResult('products-result', response);
            } catch (error) {
                showError('products-result', error);
            }
        }

        // –ö–æ—Ä–∑–∏–Ω—ã
        async function loadCarts() {
            showLoading('carts-result');
            try {
                const response = await apiClient.get('/carts');
                showResult('carts-result', response);
            } catch (error) {
                showError('carts-result', error);
            }
        }

        async function getCartByUserId(userId) {
            showLoading('carts-result');
            try {
                const response = await apiClient.get('/carts', { userId });
                showResult('carts-result', response);
            } catch (error) {
                showError('carts-result', error);
            }
        }

        async function addToCart(cartId, productId, quantity, size, color) {
            showLoading('carts-result');
            try {
                const item = {
                    productId,
                    quantity,
                    size,
                    color,
                    price: 100 // –ú–æ–∫–æ–≤–∞—è —Ü–µ–Ω–∞
                };
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –∫–æ—Ä–∑–∏–Ω—É
                const cartResponse = await apiClient.get(`/carts/${cartId}`);
                if (!cartResponse.success) {
                    throw new Error('–ö–æ—Ä–∑–∏–Ω–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
                
                const cart = cartResponse.data;
                cart.items.push(item);
                cart.total = cart.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                cart.updatedAt = new Date().toISOString();
                
                const response = await apiClient.put(`/carts/${cartId}`, cart);
                showResult('carts-result', response);
            } catch (error) {
                showError('carts-result', error);
            }
        }

        // –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
        async function loadWishlists() {
            showLoading('wishlists-result');
            try {
                const response = await apiClient.get('/wishlists');
                showResult('wishlists-result', response);
            } catch (error) {
                showError('wishlists-result', error);
            }
        }

        async function getWishlistByUserId(userId) {
            showLoading('wishlists-result');
            try {
                const response = await apiClient.get('/wishlists', { userId });
                showResult('wishlists-result', response);
            } catch (error) {
                showError('wishlists-result', error);
            }
        }

        async function addToWishlist(wishlistId, productId, size, color) {
            showLoading('wishlists-result');
            try {
                const item = {
                    productId,
                    size,
                    color,
                    addedAt: new Date().toISOString()
                };
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                const wishlistResponse = await apiClient.get(`/wishlists/${wishlistId}`);
                if (!wishlistResponse.success) {
                    throw new Error('–ò–∑–±—Ä–∞–Ω–Ω–æ–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
                }
                
                const wishlist = wishlistResponse.data;
                wishlist.items.push(item);
                wishlist.updatedAt = new Date().toISOString();
                
                const response = await apiClient.put(`/wishlists/${wishlistId}`, wishlist);
                showResult('wishlists-result', response);
            } catch (error) {
                showError('wishlists-result', error);
            }
        }

        // –¢–µ—Å—Ç—ã
        async function testApiConnection() {
            showLoading('test-result');
            try {
                const response = await apiClient.get('/users');
                if (response.success) {
                    showSuccess('test-result', '‚úÖ API —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!');
                } else {
                    showError('test-result', '‚ùå –û—à–∏–±–∫–∞ API —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
                }
            } catch (error) {
                showError('test-result', '‚ùå –û—à–∏–±–∫–∞ API —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ' + error.message);
            }
        }

        async function runAllTests() {
            showLoading('test-result');
            const tests = [];
            
            try {
                // –¢–µ—Å—Ç 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                tests.push('–¢–µ—Å—Ç 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...');
                const users = await apiClient.get('/users');
                tests.push(users.success ? '‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã' : '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π');
                
                // –¢–µ—Å—Ç 2: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤
                tests.push('–¢–µ—Å—Ç 2: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤...');
                const products = await apiClient.get('/products');
                tests.push(products.success ? '‚úÖ –¢–æ–≤–∞—Ä—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã' : '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤');
                
                // –¢–µ—Å—Ç 3: –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤
                tests.push('–¢–µ—Å—Ç 3: –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤...');
                const search = await apiClient.get('/products', { q: 'jordan' });
                tests.push(search.success ? '‚úÖ –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç' : '‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞');
                
                // –¢–µ—Å—Ç 4: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –±—Ä–µ–Ω–¥—É
                tests.push('–¢–µ—Å—Ç 4: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –±—Ä–µ–Ω–¥—É...');
                const nike = await apiClient.get('/products', { brand: 'Nike' });
                tests.push(nike.success ? '‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç' : '‚ùå –û—à–∏–±–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏');
                
                // –¢–µ—Å—Ç 5: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω
                tests.push('–¢–µ—Å—Ç 5: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω...');
                const carts = await apiClient.get('/carts');
                tests.push(carts.success ? '‚úÖ –ö–æ—Ä–∑–∏–Ω—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã' : '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä–∑–∏–Ω');
                
                showResult('test-result', tests.join('\n'));
            } catch (error) {
                showError('test-result', '‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤: ' + error.message);
            }
        }

        // –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            element.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            element.className = 'result loading';
        }

        function showResult(elementId, data) {
            const element = document.getElementById(elementId);
            element.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
            element.className = 'result success';
        }

        function showError(elementId, error) {
            const element = document.getElementById(elementId);
            element.innerHTML = '<div class="error">–û—à–∏–±–∫–∞: ' + error.message + '</div>';
            element.className = 'result error';
        }

        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.innerHTML = '<div class="success">' + message + '</div>';
            element.className = 'result success';
        }
    </script>
</body>
</html>
